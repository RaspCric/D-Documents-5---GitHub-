<VirtualHost *:80>
        ServerAdmin webmaster@localhost
        DocumentRoot /home/bookstack/www/public

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        RewriteEngine on
        RewriteCond %{HTTPS} !on
        RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost *:443>
		ServerName bookstack.totosandbox.net
		ServerAdmin bookstack@localhost
		DocumentRoot /home/bookstack/www/public/

		LogLevel warn
		ErrorLog ${APACHE_LOG_DIR}/error.log
		CustomLog ${APACHE_LOG_DIR}/access.log combined

		#SSLEngine on
		#SSLCertificateFile      /etc/letsencrypt/live/bookstack.totosandbox.net/cert.pem
		#SSLCertificateKeyFile   /etc/letsencrypt/live/bookstack.totosandbox.net/privkey.pem
		#SSLCertificateChainFile /etc/letsencrypt/live/bookstack.totosandbox.net/chain.pem
		#Include /etc/letsencrypt/options-ssl-apache.conf
		#SSLProtocol All -SSLv2 -SSLv3 -TLSv1 -TLSv1.1 -TLSv1.2
		#SSLCipherSuite HIGH:!aNULL:!MD5:!ADH:!RC4:!DH:!RSA
		#SSLHonorCipherOrder on
		#SSLCompression off
		#SSLOptions +StrictRequire
		#Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

		<FilesMatch "\.(cgi|shtml|phtml|php)$">
			SSLOptions +StdEnvVars
		</FilesMatch>

		<Directory /usr/lib/cgi-bin>
			SSLOptions +StdEnvVars
		</Directory>

		<Directory /home/bookstack/www/public>
			Options Indexes FollowSymLinks
			AllowOverride None
			Require all granted
			
			<IfModule mod_rewrite.c>
				<Ifmodule mod_negociation.c>
					Options -MultiViews -Indexes
				</IfModule>
				RewriteEngine On
				RewriteCond %{HTTP:Authorization} .
				RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
				RewriteCond %{REQUEST_FILENAME} !-d
				RewriteCond %{REQUEST_URI} (.+)/$
				RewriteRule ^ %1 [L,R=301]
				RewriteCond %{REQUEST_FILENAME} !-d
				RewriteCond %{REQUEST_FILENAME} !-f
				RewriteRule ^ index.php [L]
				</IfModule>
		</Directory>
	</VirtualHost>
</IfModule>
